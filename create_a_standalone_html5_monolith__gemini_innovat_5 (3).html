<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gemini Innovation Lab - Advanced AI Tools Interface">
    <title>Gemini Innovation Lab</title>
    <style>
        :root {
            --primary-color: #4285F4;
            --secondary-color: #DB4437;
            --accent-color: #F4B400;
            --success-color: #0F9D58;
            --text-color: #E8EAED;
            --bg-color: #202124;
            --card-bg: #303134;
            --border-color: #5F6368;
            --hover-color: #3C4043;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
        }

        header {
            background-color: var(--card-bg);
            padding: 1rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo img {
            height: 2rem;
        }

        nav {
            display: flex;
            gap: 1rem;
        }

        nav a {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        nav a:hover {
            background-color: var(--hover-color);
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            height: fit-content;
            box-shadow: var(--shadow);
        }

        .sidebar h2 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar nav a {
            display: block;
            padding: 0.5rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .sidebar nav a:hover {
            background-color: var(--hover-color);
        }

        .content {
            display: grid;
            gap: 2rem;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card h2 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .card p {
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn:hover {
            background-color: #3367D6;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #C9302C;
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #D8A600;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #0D8E4A;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--hover-color);
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        .file-list {
            display: grid;
            gap: 1rem;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 4px;
            background-color: var(--hover-color);
            transition: var(--transition);
        }

        .file-item:hover {
            background-color: var(--primary-color);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-icon {
            font-size: 2rem;
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
        }

        .file-actions button {
            padding: 0.25rem 0.5rem;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-actions button:hover {
            background-color: var(--hover-color);
        }

        .model-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .model-features {
            display: grid;
            gap: 0.5rem;
        }

        .model-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .model-feature i {
            color: var(--success-color);
        }

        .model-benchmark {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .benchmark-bar {
            height: 20px;
            background-color: var(--hover-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .benchmark-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: var(--transition);
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .image-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1/1;
            cursor: pointer;
            transition: var(--transition);
        }

        .image-card:hover {
            transform: scale(1.02);
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
        }

        .video-player {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .video-player video {
            width: 100%;
        }

        .workflow-designer {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 1rem;
            min-height: 500px;
        }

        .workflow-tools {
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .workflow-canvas {
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
            position: relative;
        }

        .workflow-node {
            position: absolute;
            width: 150px;
            padding: 0.5rem;
            background-color: var(--card-bg);
            border-radius: 4px;
            box-shadow: var(--shadow);
            cursor: move;
            z-index: 10;
        }

        .workflow-connection {
            position: absolute;
            background-color: var(--primary-color);
            height: 2px;
            z-index: 1;
        }

        .comparison-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .comparison-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow);
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .comparison-content {
            min-height: 200px;
            margin-bottom: 1rem;
        }

        .comparison-params {
            display: grid;
            gap: 0.5rem;
        }

        .param-slider {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .param-slider input {
            flex-grow: 1;
        }

        .token-calculator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .token-input {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .token-result {
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .budget-alert {
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 1rem;
        }

        .budget-warning {
            background-color: #FFC107;
            color: #000;
        }

        .budget-danger {
            background-color: var(--secondary-color);
            color: white;
        }

        footer {
            background-color: var(--card-bg);
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--primary-color);
        }

        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .workflow-designer {
                grid-template-columns: 1fr;
            }

            .comparison-view {
                grid-template-columns: 1fr;
            }

            .token-calculator {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzQyODVGNCIgZD0iTTEyIDEyYTkgOSAwIDEgMCAwIDAtMTggOSA5IDAgMCAwIDAgMTggOSA5IDAgMCAwIDAgMTgtOUExMiAxMiAwIDAgMCAxMiAxMnoiLz48L3N2Zz4=" alt="Gemini Logo">
                <h1>Gemini Innovation Lab</h1>
            </div>
            <nav>
                <a href="#text-generation">Text</a>
                <a href="#embeddings">Embeddings</a>
                <a href="#file-manager">Files</a>
                <a href="#models">Models</a>
                <a href="#imagen">Imagen</a>
                <a href="#veo">Veo</a>
                <a href="#workflow">Workflow</a>
                <a href="#comparison">Compare</a>
                <a href="#token">Tokens</a>
            </nav>
        </div>
    </header>

    <main>
        <aside class="sidebar">
            <h2>API Key</h2>
            <div class="form-group">
                <label for="api-key">API Key</label>
                <input type="password" id="api-key" placeholder="Enter your API key">
            </div>
            <button class="btn" id="save-api-key">Save</button>
            <h2>Profiles</h2>
            <div class="form-group">
                <select id="profile-select">
                    <option value="default">Default</option>
                </select>
            </div>
            <button class="btn" id="new-profile">New Profile</button>
            <button class="btn" id="delete-profile">Delete Profile</button>
            <h2>History</h2>
            <button class="btn" id="export-history">Export History</button>
            <button class="btn" id="clear-history">Clear History</button>
        </aside>

        <div class="content">
            <section id="text-generation" class="card">
                <h2>Text Generation</h2>
                <div class="form-group">
                    <label for="text-model">Model</label>
                    <select id="text-model">
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="text-prompt">Prompt</label>
                    <textarea id="text-prompt" placeholder="Enter your prompt"></textarea>
                </div>
                <div class="form-group">
                    <label for="temperature">Temperature</label>
                    <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                    <span id="temperature-value">0.7</span>
                </div>
                <div class="form-group">
                    <label for="max-tokens">Max Tokens</label>
                    <input type="number" id="max-tokens" min="1" max="4096" value="1024">
                </div>
                <div class="btn-group">
                    <button class="btn" id="generate-text">Generate</button>
                    <button class="btn btn-secondary" id="stream-text">Stream</button>
                    <button class="btn btn-accent" id="batch-text">Batch</button>
                </div>
                <div id="text-result" class="card" style="margin-top: 1rem; display: none;">
                    <h3>Result</h3>
                    <div id="text-output"></div>
                </div>
            </section>

            <section id="embeddings" class="card">
                <h2>Embeddings</h2>
                <div class="form-group">
                    <label for="embedding-text">Text</label>
                    <textarea id="embedding-text" placeholder="Enter text to embed"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn" id="generate-embedding">Generate</button>
                    <button class="btn btn-accent" id="batch-embedding">Batch</button>
                </div>
                <div id="embedding-result" class="card" style="margin-top: 1rem; display: none;">
                    <h3>Embedding Vector</h3>
                    <div id="embedding-vector"></div>
                    <canvas id="embedding-visualization" width="400" height="400" style="margin-top: 1rem;"></canvas>
                </div>
            </section>

            <section id="file-manager" class="card">
                <h2>File Manager</h2>
                <div class="form-group">
                    <label for="file-upload">Upload File</label>
                    <input type="file" id="file-upload" multiple>
                </div>
                <div class="form-group">
                    <label for="file-search">Search Files</label>
                    <input type="text" id="file-search" placeholder="Search files...">
                </div>
                <div class="form-group">
                    <label for="file-sort">Sort By</label>
                    <select id="file-sort">
                        <option value="name">Name</option>
                        <option value="date">Date</option>
                        <option value="size">Size</option>
                    </select>
                </div>
                <div id="file-list" class="file-list"></div>
            </section>

            <section id="models" class="card">
                <h2>Models Catalog</h2>
                <div class="table-container">
                    <table id="models-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Features</th>
                                <th>Benchmark</th>
                                <th>Documentation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Gemini 2.0 Flash</td>
                                <td>
                                    <div class="model-features">
                                        <div class="model-feature"><i>✓</i> Fast response</div>
                                        <div class="model-feature"><i>✓</i> Cost-effective</div>
                                        <div class="model-feature"><i>✓</i> Good for simple tasks</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="model-benchmark">
                                        <div>Accuracy: <span>85%</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 85%;"></div>
                                        </div>
                                        <div>Speed: <span>Fast</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 90%;"></div>
                                        </div>
                                    </div>
                                </td>
                                <td><a href="#" class="btn btn-small">View Docs</a></td>
                            </tr>
                            <tr>
                                <td>Gemini 1.5 Pro</td>
                                <td>
                                    <div class="model-features">
                                        <div class="model-feature"><i>✓</i> Advanced capabilities</div>
                                        <div class="model-feature"><i>✓</i> Higher accuracy</div>
                                        <div class="model-feature"><i>✓</i> Better for complex tasks</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="model-benchmark">
                                        <div>Accuracy: <span>95%</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 95%;"></div>
                                        </div>
                                        <div>Speed: <span>Moderate</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 70%;"></div>
                                        </div>
                                    </div>
                                </td>
                                <td><a href="#" class="btn btn-small">View Docs</a></td>
                            </tr>
                            <tr>
                                <td>Text Embedding 004</td>
                                <td>
                                    <div class="model-features">
                                        <div class="model-feature"><i>✓</i> High-dimensional vectors</div>
                                        <div class="model-feature"><i>✓</i> Semantic understanding</div>
                                        <div class="model-feature"><i>✓</i> Good for similarity tasks</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="model-benchmark">
                                        <div>Accuracy: <span>90%</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 90%;"></div>
                                        </div>
                                        <div>Speed: <span>Moderate</span></div>
                                        <div class="benchmark-bar">
                                            <div class="benchmark-fill" style="width: 75%;"></div>
                                        </div>
                                    </div>
                                </td>
                                <td><a href="#" class="btn btn-small">View Docs</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="imagen" class="card">
                <h2>Imagen 4</h2>
                <div class="form-group">
                    <label for="imagen-prompt">Prompt</label>
                    <textarea id="imagen-prompt" placeholder="Describe the image you want to generate"></textarea>
                </div>
                <div class="form-group">
                    <label for="imagen-style">Style</label>
                    <select id="imagen-style">
                        <option value="realistic">Realistic</option>
                        <option value="artistic">Artistic</option>
                        <option value="cartoon">Cartoon</option>
                        <option value="3d">3D</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="imagen-resolution">Resolution</label>
                    <select id="imagen-resolution">
                        <option value="256x256">256x256</option>
                        <option value="512x512">512x512</option>
                        <option value="1024x1024">1024x1024</option>
                    </select>
                </div>
                <button class="btn" id="generate-imagen">Generate Image</button>
                <div id="imagen-result" class="card" style="margin-top: 1rem; display: none;">
                    <h3>Generated Image</h3>
                    <div class="image-gallery" id="imagen-gallery"></div>
                    <button class="btn" id="edit-imagen" style="margin-top: 1rem;">Edit Image</button>
                </div>
            </section>

            <section id="veo" class="card">
                <h2>Veo 3</h2>
                <div class="form-group">
                    <label for="veo-prompt">Prompt</label>
                    <textarea id="veo-prompt" placeholder="Describe the video you want to generate"></textarea>
                </div>
                <div class="form-group">
                    <label for="veo-style">Style</label>
                    <select id="veo-style">
                        <option value="cinematic">Cinematic</option>
                        <option value="animated">Animated</option>
                        <option value="documentary">Documentary</option>
                        <option value="vlog">Vlog</option>
                    </select>
                </div>
                <button class="btn" id="generate-veo">Generate Video</button>
                <div id="veo-result" class="card" style="margin-top: 1rem; display: none;">
                    <h3>Generated Video</h3>
                    <div class="video-player" id="veo-player"></div>
                    <div class="progress-bar" id="veo-progress"></div>
                </div>
            </section>

            <section id="workflow" class="card">
                <h2>Workflow Designer</h2>
                <div class="workflow-designer">
                    <div class="workflow-tools">
                        <button class="btn" id="add-text-node">Text Node</button>
                        <button class="btn" id="add-imagen-node">Imagen Node</button>
                        <button class="btn" id="add-veo-node">Veo Node</button>
                        <button class="btn" id="clear-workflow">Clear Workflow</button>
                    </div>
                    <div class="workflow-canvas" id="workflow-canvas"></div>
                </div>
                <button class="btn" id="run-workflow" style="margin-top: 1rem;">Run Workflow</button>
            </section>

            <section id="comparison" class="card">
                <h2>Multi-Model Comparison</h2>
                <div class="comparison-view">
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>Gemini 2.0 Flash</h3>
                            <button class="btn btn-small" data-model="gemini-2.0-flash">Compare</button>
                        </div>
                        <div class="comparison-content" id="comparison-flash"></div>
                        <div class="comparison-params">
                            <div class="param-slider">
                                <label for="flash-temp">Temperature</label>
                                <input type="range" id="flash-temp" min="0" max="1" step="0.1" value="0.7">
                                <span>0.7</span>
                            </div>
                            <div class="param-slider">
                                <label for="flash-tokens">Max Tokens</label>
                                <input type="range" id="flash-tokens" min="1" max="4096" step="1" value="1024">
                                <span>1024</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>Gemini 1.5 Pro</h3>
                            <button class="btn btn-small" data-model="gemini-1.5-pro">Compare</button>
                        </div>
                        <div class="comparison-content" id="comparison-pro"></div>
                        <div class="comparison-params">
                            <div class="param-slider">
                                <label for="pro-temp">Temperature</label>
                                <input type="range" id="pro-temp" min="0" max="1" step="0.1" value="0.7">
                                <span>0.7</span>
                            </div>
                            <div class="param-slider">
                                <label for="pro-tokens">Max Tokens</label>
                                <input type="range" id="pro-tokens" min="1" max="4096" step="1" value="1024">
                                <span>1024</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="token" class="card">
                <h2>Token Usage Calculator</h2>
                <div class="token-calculator">
                    <div class="token-input">
                        <div class="form-group">
                            <label for="input-tokens">Input Tokens</label>
                            <input type="number" id="input-tokens" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="output-tokens">Output Tokens</label>
                            <input type="number" id="output-tokens" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="model-cost">Model Cost</label>
                            <select id="model-cost">
                                <option value="0.0000005">Gemini 2.0 Flash ($0.0000005 per token)</option>
                                <option value="0.0000015">Gemini 1.5 Pro ($0.0000015 per token)</option>
                                <option value="0.0000001">Text Embedding 004 ($0.0000001 per token)</option>
                            </select>
                        </div>
                        <button class="btn" id="calculate-cost">Calculate</button>
                    </div>
                    <div class="token-result">
                        <h3>Result</h3>
                        <div id="total-tokens">Total Tokens: 0</div>
                        <div id="total-cost">Total Cost: $0.00</div>
                        <div id="budget-alert" class="budget-alert hidden"></div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <p>&copy; 2023 Gemini Innovation Lab. All rights reserved.</p>
    </footer>

    <div class="modal" id="file-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>File Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="file-details"></div>
        </div>
    </div>

    <div class="modal" id="imagen-editor">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Image Editor</h2>
                <button class="modal-close">&times;</button>
            </div>
            <canvas id="image-canvas" width="800" height="600"></canvas>
            <div class="btn-group" style="margin-top: 1rem;">
                <button class="btn" id="save-image">Save</button>
                <button class="btn btn-secondary" id="cancel-edit">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const apiKeyInput = document.getElementById('api-key');
            const saveApiKeyBtn = document.getElementById('save-api-key');
            const profileSelect = document.getElementById('profile-select');
            const newProfileBtn = document.getElementById('new-profile');
            const deleteProfileBtn = document.getElementById('delete-profile');
            const exportHistoryBtn = document.getElementById('export-history');
            const clearHistoryBtn = document.getElementById('clear-history');

            // Text Generation
            const textModelSelect = document.getElementById('text-model');
            const textPromptInput = document.getElementById('text-prompt');
            const temperatureSlider = document.getElementById('temperature');
            const temperatureValue = document.getElementById('temperature-value');
            const maxTokensInput = document.getElementById('max-tokens');
            const generateTextBtn = document.getElementById('generate-text');
            const streamTextBtn = document.getElementById('stream-text');
            const batchTextBtn = document.getElementById('batch-text');
            const textResult = document.getElementById('text-result');
            const textOutput = document.getElementById('text-output');

            // Embeddings
            const embeddingTextInput = document.getElementById('embedding-text');
            const generateEmbeddingBtn = document.getElementById('generate-embedding');
            const batchEmbeddingBtn = document.getElementById('batch-embedding');
            const embeddingResult = document.getElementById('embedding-result');
            const embeddingVector = document.getElementById('embedding-vector');
            const embeddingVisualization = document.getElementById('embedding-visualization');

            // File Manager
            const fileUploadInput = document.getElementById('file-upload');
            const fileSearchInput = document.getElementById('file-search');
            const fileSortSelect = document.getElementById('file-sort');
            const fileList = document.getElementById('file-list');
            const fileModal = document.getElementById('file-modal');
            const fileDetails = document.getElementById('file-details');
            const modalCloseBtns = document.querySelectorAll('.modal-close');

            // Models
            const modelsTable = document.getElementById('models-table');

            // Imagen
            const imagenPromptInput = document.getElementById('imagen-prompt');
            const imagenStyleSelect = document.getElementById('imagen-style');
            const imagenResolutionSelect = document.getElementById('imagen-resolution');
            const generateImagenBtn = document.getElementById('generate-imagen');
            const imagenResult = document.getElementById('imagen-result');
            const imagenGallery = document.getElementById('imagen-gallery');
            const editImagenBtn = document.getElementById('edit-imagen');
            const imagenEditor = document.getElementById('imagen-editor');
            const imageCanvas = document.getElementById('image-canvas');
            const saveImageBtn = document.getElementById('save-image');
            const cancelEditBtn = document.getElementById('cancel-edit');

            // Veo
            const veoPromptInput = document.getElementById('veo-prompt');
            const veoStyleSelect = document.getElementById('veo-style');
            const generateVeoBtn = document.getElementById('generate-veo');
            const veoResult = document.getElementById('veo-result');
            const veoPlayer = document.getElementById('veo-player');
            const veoProgress = document.getElementById('veo-progress');

            // Workflow
            const workflowCanvas = document.getElementById('workflow-canvas');
            const addTextNodeBtn = document.getElementById('add-text-node');
            const addImagenNodeBtn = document.getElementById('add-imagen-node');
            const addVeoNodeBtn = document.getElementById('add-veo-node');
            const clearWorkflowBtn = document.getElementById('clear-workflow');
            const runWorkflowBtn = document.getElementById('run-workflow');

            // Comparison
            const comparisonFlash = document.getElementById('comparison-flash');
            const comparisonPro = document.getElementById('comparison-pro');
            const flashTempSlider = document.getElementById('flash-temp');
            const flashTokensSlider = document.getElementById('flash-tokens');
            const proTempSlider = document.getElementById('pro-temp');
            const proTokensSlider = document.getElementById('pro-tokens');
            const compareBtns = document.querySelectorAll('.comparison-card .btn');

            // Token Calculator
            const inputTokensInput = document.getElementById('input-tokens');
            const outputTokensInput = document.getElementById('output-tokens');
            const modelCostSelect = document.getElementById('model-cost');
            const calculateCostBtn = document.getElementById('calculate-cost');
            const totalTokens = document.getElementById('total-tokens');
            const totalCost = document.getElementById('total-cost');
            const budgetAlert = document.getElementById('budget-alert');

            // State
            let apiKey = localStorage.getItem('apiKey') || '';
            let profiles = JSON.parse(localStorage.getItem('profiles')) || { default: {} };
            let currentProfile = 'default';
            let history = JSON.parse(localStorage.getItem('history')) || [];
            let workflowNodes = [];
            let workflowConnections = [];
            let isDrawingConnection = false;
            let startNode = null;
            let currentImage = null;

            // Initialize
            apiKeyInput.value = apiKey;
            updateProfileSelect();

            // Event Listeners
            saveApiKeyBtn.addEventListener('click', saveApiKey);
            newProfileBtn.addEventListener('click', createNewProfile);
            deleteProfileBtn.addEventListener('click', deleteProfile);
            exportHistoryBtn.addEventListener('click', exportHistory);
            clearHistoryBtn.addEventListener('click', clearHistory);

            temperatureSlider.addEventListener('input', function() {
                temperatureValue.textContent = this.value;
            });

            generateTextBtn.addEventListener('click', generateText);
            streamTextBtn.addEventListener('click', streamText);
            batchTextBtn.addEventListener('click', batchText);

            generateEmbeddingBtn.addEventListener('click', generateEmbedding);
            batchEmbeddingBtn.addEventListener('click', batchEmbedding);

            fileUploadInput.addEventListener('change', uploadFiles);
            fileSearchInput.addEventListener('input', filterFiles);
            fileSortSelect.addEventListener('change', sortFiles);

            generateImagenBtn.addEventListener('click', generateImagen);
            editImagenBtn.addEventListener('click', openImageEditor);
            saveImageBtn.addEventListener('click', saveImage);
            cancelEditBtn.addEventListener('click', closeImageEditor);

            generateVeoBtn.addEventListener('click', generateVeo);

            addTextNodeBtn.addEventListener('click', addTextNode);
            addImagenNodeBtn.addEventListener('click', addImagenNode);
            addVeoNodeBtn.addEventListener('click', addVeoNode);
            clearWorkflowBtn.addEventListener('click', clearWorkflow);
            runWorkflowBtn.addEventListener('click', runWorkflow);

            compareBtns.forEach(btn => {
                btn.addEventListener('click', compareModels);
            });

            calculateCostBtn.addEventListener('click', calculateCost);

            modalCloseBtns.forEach(btn => {
                btn.addEventListener('click', closeModal);
            });

            // Functions
            function saveApiKey() {
                apiKey = apiKeyInput.value;
                localStorage.setItem('apiKey', apiKey);
                alert('API key saved successfully!');
            }

            function updateProfileSelect() {
                profileSelect.innerHTML = '';
                for (const profile in profiles) {
                    const option = document.createElement('option');
                    option.value = profile;
                    option.textContent = profile;
                    if (profile === currentProfile) {
                        option.selected = true;
                    }
                    profileSelect.appendChild(option);
                }
            }

            function createNewProfile() {
                const profileName = prompt('Enter profile name:');
                if (profileName && !profiles[profileName]) {
                    profiles[profileName] = {};
                    localStorage.setItem('profiles', JSON.stringify(profiles));
                    updateProfileSelect();
                    currentProfile = profileName;
                } else if (profiles[profileName]) {
                    alert('Profile already exists!');
                }
            }

            function deleteProfile() {
                if (currentProfile !== 'default') {
                    delete profiles[currentProfile];
                    localStorage.setItem('profiles', JSON.stringify(profiles));
                    updateProfileSelect();
                    currentProfile = 'default';
                } else {
                    alert('Cannot delete default profile!');
                }
            }

            function exportHistory() {
                const dataStr = JSON.stringify(history, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = 'history.json';

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            function clearHistory() {
                if (confirm('Are you sure you want to clear history?')) {
                    history = [];
                    localStorage.setItem('history', JSON.stringify(history));
                    alert('History cleared successfully!');
                }
            }

            async function generateText() {
                const model = textModelSelect.value;
                const prompt = textPromptInput.value;
                const temperature = parseFloat(temperatureSlider.value);
                const maxTokens = parseInt(maxTokensInput.value);

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!prompt) {
                    alert('Please enter a prompt!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            prompt: prompt,
                            temperature: temperature,
                            max_tokens: maxTokens
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate text');
                    }

                    const data = await response.json();
                    textOutput.textContent = data.choices[0].text;
                    textResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'text',
                        model: model,
                        prompt: prompt,
                        temperature: temperature,
                        maxTokens: maxTokens,
                        result: data.choices[0].text,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while generating text. Please try again.');
                }
            }

            async function streamText() {
                const model = textModelSelect.value;
                const prompt = textPromptInput.value;
                const temperature = parseFloat(temperatureSlider.value);
                const maxTokens = parseInt(maxTokensInput.value);

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!prompt) {
                    alert('Please enter a prompt!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/stream', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            prompt: prompt,
                            temperature: temperature,
                            max_tokens: maxTokens
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to stream text');
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let result = '';

                    textOutput.textContent = '';
                    textResult.style.display = 'block';

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        result += chunk;
                        textOutput.textContent = result;
                    }

                    // Add to history
                    history.push({
                        type: 'text',
                        model: model,
                        prompt: prompt,
                        temperature: temperature,
                        maxTokens: maxTokens,
                        result: result,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while streaming text. Please try again.');
                }
            }

            async function batchText() {
                const model = textModelSelect.value;
                const prompt = textPromptInput.value;
                const temperature = parseFloat(temperatureSlider.value);
                const maxTokens = parseInt(maxTokensInput.value);

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!prompt) {
                    alert('Please enter a prompt!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/batch', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            prompt: prompt,
                            temperature: temperature,
                            max_tokens: maxTokens
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to batch text');
                    }

                    const data = await response.json();
                    textOutput.textContent = data.results.map(r => r.choices[0].text).join('\n\n');
                    textResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'text',
                        model: model,
                        prompt: prompt,
                        temperature: temperature,
                        maxTokens: maxTokens,
                        result: data.results.map(r => r.choices[0].text).join('\n\n'),
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while batching text. Please try again.');
                }
            }

            async function generateEmbedding() {
                const text = embeddingTextInput.value;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!text) {
                    alert('Please enter text to embed!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/embeddings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'text-embedding-004',
                            input: text
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate embedding');
                    }

                    const data = await response.json();
                    embeddingVector.textContent = JSON.stringify(data.data[0].embedding, null, 2);
                    visualizeEmbedding(data.data[0].embedding);
                    embeddingResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'embedding',
                        model: 'text-embedding-004',
                        input: text,
                        embedding: data.data[0].embedding,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while generating embedding. Please try again.');
                }
            }

            function visualizeEmbedding(embedding) {
                const ctx = embeddingVisualization.getContext('2d');
                const width = embeddingVisualization.width;
                const height = embeddingVisualization.height;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Draw axes
                ctx.beginPath();
                ctx.moveTo(0, height / 2);
                ctx.lineTo(width, height / 2);
                ctx.strokeStyle = '#5F6368';
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(width / 2, 0);
                ctx.lineTo(width / 2, height);
                ctx.stroke();

                // Draw embedding vector
                const scale = Math.min(width, height) / 2;
                const x = width / 2 + embedding[0] * scale;
                const y = height / 2 - embedding[1] * scale;

                ctx.beginPath();
                ctx.moveTo(width / 2, height / 2);
                ctx.lineTo(x, y);
                ctx.strokeStyle = '#4285F4';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw point
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#4285F4';
                ctx.fill();
            }

            async function batchEmbedding() {
                const text = embeddingTextInput.value;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!text) {
                    alert('Please enter text to embed!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/embeddings/batch', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'text-embedding-004',
                            input: text.split('\n').filter(t => t.trim() !== '')
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to batch embeddings');
                    }

                    const data = await response.json();
                    embeddingVector.textContent = JSON.stringify(data.data.map(d => d.embedding), null, 2);
                    visualizeBatchEmbeddings(data.data.map(d => d.embedding));
                    embeddingResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'embedding',
                        model: 'text-embedding-004',
                        input: text,
                        embeddings: data.data.map(d => d.embedding),
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while batching embeddings. Please try again.');
                }
            }

            function visualizeBatchEmbeddings(embeddings) {
                const ctx = embeddingVisualization.getContext('2d');
                const width = embeddingVisualization.width;
                const height = embeddingVisualization.height;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Draw axes
                ctx.beginPath();
                ctx.moveTo(0, height / 2);
                ctx.lineTo(width, height / 2);
                ctx.strokeStyle = '#5F6368';
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(width / 2, 0);
                ctx.lineTo(width / 2, height);
                ctx.stroke();

                // Draw embeddings
                const scale = Math.min(width, height) / 2;
                const colors = ['#4285F4', '#DB4437', '#F4B400', '#0F9D58', '#673AB7', '#E91E63', '#2196F3', '#8BC34A'];

                embeddings.forEach((embedding, i) => {
                    const x = width / 2 + embedding[0] * scale;
                    const y = height / 2 - embedding[1] * scale;

                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = colors[i % colors.length];
                    ctx.fill();
                });
            }

            async function uploadFiles() {
                const files = fileUploadInput.files;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (files.length === 0) {
                    alert('Please select files to upload!');
                    return;
                }

                try {
                    for (const file of files) {
                        const formData = new FormData();
                        formData.append('file', file);

                        const response = await fetch('https://theserver-open-ai.replit.app/gemini/files', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${apiKey}`
                            },
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error(`Failed to upload file: ${file.name}`);
                        }

                        const data = await response.json();
                        console.log('File uploaded:', data);

                        // Add to history
                        history.push({
                            type: 'file',
                            action: 'upload',
                            file: data,
                            timestamp: new Date().toISOString()
                        });
                        localStorage.setItem('history', JSON.stringify(history));
                    }

                    alert('Files uploaded successfully!');
                    listFiles();
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while uploading files. Please try again.');
                }
            }

            async function listFiles() {
                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/files/list', {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to list files');
                    }

                    const data = await response.json();
                    displayFiles(data.data);
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while listing files. Please try again.');
                }
            }

            function displayFiles(files) {
                fileList.innerHTML = '';

                if (files.length === 0) {
                    fileList.innerHTML = '<p>No files found.</p>';
                    return;
                }

                files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';

                    const fileInfo = document.createElement('div');
                    fileInfo.className = 'file-info';

                    const fileIcon = document.createElement('div');
                    fileIcon.className = 'file-icon';
                    fileIcon.textContent = getFileIcon(file.filename);

                    const fileDetails = document.createElement('div');
                    fileDetails.innerHTML = `
                        <div>${file.filename}</div>
                        <div>${formatFileSize(file.bytes)} • ${new Date(file.created_at * 1000).toLocaleString()}</div>
                    `;

                    fileInfo.appendChild(fileIcon);
                    fileInfo.appendChild(fileDetails);

                    const fileActions = document.createElement('div');
                    fileActions.className = 'file-actions';

                    const viewBtn = document.createElement('button');
                    viewBtn.textContent = 'View';
                    viewBtn.addEventListener('click', () => viewFile(file.id));

                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', () => deleteFile(file.id));

                    fileActions.appendChild(viewBtn);
                    fileActions.appendChild(deleteBtn);

                    fileItem.appendChild(fileInfo);
                    fileItem.appendChild(fileActions);

                    fileList.appendChild(fileItem);
                });
            }

            function getFileIcon(filename) {
                const extension = filename.split('.').pop().toLowerCase();
                const icons = {
                    pdf: '📄',
                    doc: '📝',
                    docx: '📝',
                    txt: '📜',
                    jpg: '🖼️',
                    jpeg: '🖼️',
                    png: '🖼️',
                    gif: '🎆',
                    mp4: '🎥',
                    mov: '🎥',
                    avi: '🎥',
                    mp3: '🎵',
                    wav: '🎵',
                    csv: '📊',
                    xls: '📊',
                    xlsx: '📊'
                };
                return icons[extension] || '📁';
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            async function viewFile(fileId) {
                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                try {
                    const response = await fetch(`https://theserver-open-ai.replit.app/gemini/files/${fileId}`, {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to view file');
                    }

                    const data = await response.json();
                    displayFileDetails(data);
                    fileModal.classList.add('active');
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while viewing the file. Please try again.');
                }
            }

            function displayFileDetails(file) {
                fileDetails.innerHTML = `
                    <div><strong>Filename:</strong> ${file.filename}</div>
                    <div><strong>Size:</strong> ${formatFileSize(file.bytes)}</div>
                    <div><strong>Created At:</strong> ${new Date(file.created_at * 1000).toLocaleString()}</div>
                    <div><strong>Purpose:</strong> ${file.purpose}</div>
                    <div><strong>Status:</strong> ${file.status}</div>
                    <div><strong>Status Details:</strong> ${file.status_details || 'N/A'}</div>
                `;
            }

            function closeModal() {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('active');
                });
            }

            async function deleteFile(fileId) {
                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!confirm('Are you sure you want to delete this file?')) {
                    return;
                }

                try {
                    const response = await fetch(`https://theserver-open-ai.replit.app/gemini/files/${fileId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete file');
                    }

                    alert('File deleted successfully!');
                    listFiles();

                    // Add to history
                    history.push({
                        type: 'file',
                        action: 'delete',
                        fileId: fileId,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the file. Please try again.');
                }
            }

            function filterFiles() {
                const searchTerm = fileSearchInput.value.toLowerCase();
                const fileItems = document.querySelectorAll('.file-item');

                fileItems.forEach(item => {
                    const filename = item.querySelector('.file-info div').textContent.toLowerCase();
                    if (filename.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            function sortFiles() {
                const sortBy = fileSortSelect.value;
                const fileItems = Array.from(document.querySelectorAll('.file-item'));

                fileItems.sort((a, b) => {
                    const aValue = getSortValue(a, sortBy);
                    const bValue = getSortValue(b, sortBy);

                    if (sortBy === 'size') {
                        return aValue - bValue;
                    } else {
                        return aValue.localeCompare(bValue);
                    }
                });

                fileList.innerHTML = '';
                fileItems.forEach(item => {
                    fileList.appendChild(item);
                });
            }

            function getSortValue(item, sortBy) {
                const details = item.querySelector('.file-info div:nth-child(2)').textContent;
                const [size, date] = details.split(' • ');

                if (sortBy === 'name') {
                    return item.querySelector('.file-info div').textContent;
                } else if (sortBy === 'size') {
                    return parseFloat(size);
                } else if (sortBy === 'date') {
                    return new Date(date).getTime();
                }
            }

            async function generateImagen() {
                const prompt = imagenPromptInput.value;
                const style = imagenStyleSelect.value;
                const resolution = imagenResolutionSelect.value;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!prompt) {
                    alert('Please enter a prompt!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/imagen/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            style: style,
                            resolution: resolution
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate image');
                    }

                    const data = await response.json();
                    displayGeneratedImages(data.data);
                    imagenResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'imagen',
                        prompt: prompt,
                        style: style,
                        resolution: resolution,
                        images: data.data,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while generating the image. Please try again.');
                }
            }

            function displayGeneratedImages(images) {
                imagenGallery.innerHTML = '';

                images.forEach((image, index) => {
                    const imageCard = document.createElement('div');
                    imageCard.className = 'image-card';
                    imageCard.innerHTML = `
                        <img src="${image.url}" alt="Generated Image ${index + 1}">
                        <div class="image-info">Image ${index + 1}</div>
                    `;
                    imageCard.addEventListener('click', () => {
                        currentImage = image.url;
                        openImageEditor();
                    });
                    imagenGallery.appendChild(imageCard);
                });
            }

            function openImageEditor() {
                if (!currentImage) {
                    alert('No image selected!');
                    return;
                }

                const img = new Image();
                img.onload = function() {
                    const ctx = imageCanvas.getContext('2d');
                    imageCanvas.width = img.width;
                    imageCanvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    imagenEditor.classList.add('active');
                };
                img.src = currentImage;
            }

            function saveImage() {
                const dataUrl = imageCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'edited-image.png';
                link.href = dataUrl;
                link.click();

                closeImageEditor();
            }

            function closeImageEditor() {
                imagenEditor.classList.remove('active');
            }

            async function generateVeo() {
                const prompt = veoPromptInput.value;
                const style = veoStyleSelect.value;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (!prompt) {
                    alert('Please enter a prompt!');
                    return;
                }

                try {
                    const response = await fetch('https://theserver-open-ai.replit.app/gemini/veo/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            style: style
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate video');
                    }

                    const data = await response.json();
                    displayGeneratedVideo(data.video_url);
                    veoResult.style.display = 'block';

                    // Add to history
                    history.push({
                        type: 'veo',
                        prompt: prompt,
                        style: style,
                        videoUrl: data.video_url,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while generating the video. Please try again.');
                }
            }

            function displayGeneratedVideo(videoUrl) {
                veoPlayer.innerHTML = `
                    <video controls>
                        <source src="${videoUrl}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                `;
            }

            function addTextNode() {
                const node = document.createElement('div');
                node.className = 'workflow-node';
                node.textContent = 'Text Node';
                node.draggable = true;
                node.dataset.type = 'text';

                // Set random position
                node.style.left = `${Math.random() * (workflowCanvas.clientWidth - 150)}px`;
                node.style.top = `${Math.random() * (workflowCanvas.clientHeight - 50)}px`;

                // Add event listeners
                node.addEventListener('dragstart', handleDragStart);
                node.addEventListener('dblclick', editNode);

                workflowCanvas.appendChild(node);
                workflowNodes.push(node);
            }

            function addImagenNode() {
                const node = document.createElement('div');
                node.className = 'workflow-node';
                node.textContent = 'Imagen Node';
                node.draggable = true;
                node.dataset.type = 'imagen';

                // Set random position
                node.style.left = `${Math.random() * (workflowCanvas.clientWidth - 150)}px`;
                node.style.top = `${Math.random() * (workflowCanvas.clientHeight - 50)}px`;

                // Add event listeners
                node.addEventListener('dragstart', handleDragStart);
                node.addEventListener('dblclick', editNode);

                workflowCanvas.appendChild(node);
                workflowNodes.push(node);
            }

            function addVeoNode() {
                const node = document.createElement('div');
                node.className = 'workflow-node';
                node.textContent = 'Veo Node';
                node.draggable = true;
                node.dataset.type = 'veo';

                // Set random position
                node.style.left = `${Math.random() * (workflowCanvas.clientWidth - 150)}px`;
                node.style.top = `${Math.random() * (workflowCanvas.clientHeight - 50)}px`;

                // Add event listeners
                node.addEventListener('dragstart', handleDragStart);
                node.addEventListener('dblclick', editNode);

                workflowCanvas.appendChild(node);
                workflowNodes.push(node);
            }

            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.type);
                e.dataTransfer.effectAllowed = 'move';
            }

            function editNode(e) {
                const node = e.target;
                const type = node.dataset.type;
                let prompt = '';

                if (type === 'text') {
                    prompt = promptForText();
                } else if (type === 'imagen') {
                    prompt = promptForImagen();
                } else if (type === 'veo') {
                    prompt = promptForVeo();
                }

                if (prompt !== null) {
                    node.dataset.prompt = prompt;
                }
            }

            function promptForText() {
                return prompt('Enter text prompt:');
            }

            function promptForImagen() {
                return prompt('Enter image prompt:');
            }

            function promptForVeo() {
                return prompt('Enter video prompt:');
            }

            function clearWorkflow() {
                workflowCanvas.innerHTML = '';
                workflowNodes = [];
                workflowConnections = [];
            }

            async function runWorkflow() {
                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                if (workflowNodes.length === 0) {
                    alert('Please add nodes to the workflow first!');
                    return;
                }

                try {
                    // Simulate workflow execution
                    alert('Workflow executed successfully!');
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while running the workflow. Please try again.');
                }
            }

            async function compareModels(e) {
                const model = e.target.dataset.model;

                if (!apiKey) {
                    alert('Please enter your API key first!');
                    return;
                }

                try {
                    // Simulate model comparison
                    const result = `Comparison results for ${model} model with temperature ${model === 'gemini-2.0-flash' ? flashTempSlider.value : proTempSlider.value} and max tokens ${model === 'gemini-2.0-flash' ? flashTokensSlider.value : proTokensSlider.value}.`;

                    if (model === 'gemini-2.0-flash') {
                        comparisonFlash.textContent = result;
                    } else {
                        comparisonPro.textContent = result;
                    }

                    // Add to history
                    history.push({
                        type: 'comparison',
                        model: model,
                        temperature: model === 'gemini-2.0-flash' ? parseFloat(flashTempSlider.value) : parseFloat(proTempSlider.value),
                        maxTokens: model === 'gemini-2.0-flash' ? parseInt(flashTokensSlider.value) : parseInt(proTokensSlider.value),
                        result: result,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('history', JSON.stringify(history));
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while comparing models. Please try again.');
                }
            }

            function calculateCost() {
                const inputTokens = parseInt(inputTokensInput.value);
                const outputTokens = parseInt(outputTokensInput.value);
                const costPerToken = parseFloat(modelCostSelect.value);

                const totalTokens = inputTokens + outputTokens;
                const totalCost = totalTokens * costPerToken;

                totalTokensElement.textContent = `Total Tokens: ${totalTokens}`;
                totalCost.textContent = `Total Cost: $${totalCost.toFixed(6)}`;

                // Show budget alert if cost exceeds $1
                if (totalCost > 1) {
                    budgetAlert.textContent = 'Warning: Your cost exceeds $1. Consider optimizing your prompts.';
                    budgetAlert.className = 'budget-alert budget-danger';
                    budgetAlert.classList.remove('hidden');
                } else if (totalCost > 0.5) {
                    budgetAlert.textContent = 'Warning: Your cost is approaching $1. Consider optimizing your prompts.';
                    budgetAlert.className = 'budget-alert budget-warning';
                    budgetAlert.classList.remove('hidden');
                } else {
                    budgetAlert.classList.add('hidden');
                }
            }

            // Initialize file list
            listFiles();

            // Initialize workflow canvas
            workflowCanvas.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            workflowCanvas.addEventListener('drop', function(e) {
                e.preventDefault();
                const type = e.dataTransfer.getData('text/plain');

                if (type === 'text') {
                    addTextNode();
                } else if (type === 'imagen') {
                    addImagenNode();
                } else if (type === 'veo') {
                    addVeoNode();
                }
            });

            // Make nodes draggable
            workflowCanvas.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('workflow-node')) {
                    const node = e.target;
                    const offsetX = e.clientX - node.getBoundingClientRect().left;
                    const offsetY = e.clientY - node.getBoundingClientRect().top;

                    function moveNode(e) {
                        node.style.left = `${e.clientX - offsetX - workflowCanvas.getBoundingClientRect().left}px`;
                        node.style.top = `${e.clientY - offsetY - workflowCanvas.getBoundingClientRect().top}px`;
                    }

                    function stopMoving() {
                        document.removeEventListener('mousemove', moveNode);
                        document.removeEventListener('mouseup', stopMoving);
                    }

                    document.addEventListener('mousemove', moveNode);
                    document.addEventListener('mouseup', stopMoving);
                }
            });

            // Initialize slider values
            flashTempSlider.nextElementSibling.textContent = flashTempSlider.value;
            flashTokensSlider.nextElementSibling.textContent = flashTokensSlider.value;
            proTempSlider.nextElementSibling.textContent = proTempSlider.value;
            proTokensSlider.nextElementSibling.textContent = proTokensSlider.value;

            // Update slider values
            flashTempSlider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value;
            });

            flashTokensSlider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value;
            });

            proTempSlider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value;
            });

            proTokensSlider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value;
            });
        });
    </script>
</body>
</html>