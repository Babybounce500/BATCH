```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOD AI Stock Market Psychic</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --dark-color: #2d3436;
            --light-color: #f5f6fa;
            --success-color: #00b894;
            --danger-color: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: var(--light-color);
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: var(--light-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s nav ul li a:hover {
            color: var(--secondary-color);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 30px;
        }

        .sidebar {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .stock-search {
            display: flex;
            margin-bottom: 20px;
        }

        .stock-search input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 16px;
        }

        .stock-search button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .stock-search button:hover {
            background-color: var(--secondary-color);
        }

        .stock-info {
            margin-bottom: 20px;
        }

        .stock-info h3 {
            margin-bottom: 10px;
        }

        .stock-info p {
            margin-bottom: 5px;
        }

        .chart-container {
            height: 400px;
            margin-bottom: 30px;
        }

        .trend-analysis {
            margin-bottom: 30px;
        }

        .trend-analysis h3 {
            margin-bottom: 15px;
        }

        .trend-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-card h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .metric-card p {
            font-size: 18px;
            font-weight: 600;
        }

        .prediction {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .prediction h3 {
            margin-bottom: 15px;
        }

        .prediction-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .prediction-value {
            font-size: 24px;
            font-weight: 700;
        }

        .prediction-trend {
            font-size: 18px;
            font-weight: 600;
        }

        .up {
            color: var(--success-color);
        }

        .down {
            color: var(--danger-color);
        }

        .backtest {
            margin-bottom: 30px;
        }

        .backtest h3 {
            margin-bottom: 15px;
        }

        .backtest-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .backtest-button {
            grid-column: span 2;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .backtest-button:hover {
            background-color: var(--secondary-color);
        }

        .backtest-results {
            display: none;
            margin-top: 20px;
        }

        .backtest-results.active {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .result-card h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .result-card p {
            font-size: 18px;
            font-weight: 600;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            background-color: var(--dark-color);
            color: var(--light-color);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .backtest-form {
                grid-template-columns: 1fr;
            }

            .backtest-button {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">EOD AI Stock Market Psychic</div>
            <nav>
                <ul>
                    <li><a href="#">Dashboard</a></li>
                    <li><a href="#">Market Trends</a></li>
                    <li><a href="#">Predictions</a></li>
                    <li><a href="#">Backtesting</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <aside class="sidebar">
                <div class="stock-search">
                    <input type="text" id="stockSymbol" placeholder="Enter stock symbol (e.g., AAPL)">
                    <button id="searchButton">Search</button>
                </div>

                <div class="stock-info" id="stockInfo">
                    <h3>Stock Information</h3>
                    <p><strong>Symbol:</strong> <span id="symbol">-</span></p>
                    <p><strong>Company:</strong> <span id="companyName">-</span></p>
                    <p><strong>Exchange:</strong> <span id="exchange">-</span></p>
                    <p><strong>Currency:</strong> <span id="currency">-</span></p>
                    <p><strong>Current Price:</strong> <span id="currentPrice">-</span></p>
                    <p><strong>Previous Close:</strong> <span id="previousClose">-</span></p>
                    <p><strong>Change:</strong> <span id="change">-</span></p>
                    <p><strong>Change Percent:</strong> <span id="changePercent">-</span></p>
                </div>

                <div class="trend-analysis">
                    <h3>Trend Analysis</h3>
                    <div class="trend-metrics">
                        <div class="metric-card">
                            <h4>RSI (14)</h4>
                            <p id="rsi">-</p>
                        </div>
                        <div class="metric-card">
                            <h4>MACD</h4>
                            <p id="</p>
                        </div>
                        <div class="metric-card">
                            <h4>Stochastic</h4>
                            <p id="st">-</p>
                        </div>
                        <div class=" <h4>ADX</h4>
                            <p id="adx">-</p>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="content">
                <section>
                    <h2 class="section-title">Market Data Visualization</h2>
                    <div class="chart-container" id="chart"></div>
                </section>

                <section class="prediction">
                    <h2 class="section-title">Stock Price Prediction</h2>
                    <div class="prediction-result">
                        <div>
                            <h3>Predicted Price:</h3>
                            <p class="prediction-value" id="predictedPrice">-</p>
                        </div>
                        <div>
                            <h3>Trend:</h3>
                            <p class="prediction-trend" id="trend">-</p>
                        </div>
                    </div>
                </section>

                <section class="backtest">
                    <h2 class="section-title">Algorithmic Trading Strategy Backtesting</h2>
                    <form="backtest-form" id="backtestForm">
                        <div class="form-group">
                            <label for="strategy">Strategy:</label>
                            <select id="strategy">
                                <option value="movingAverage">Moving Average Crossover</option>
                                <option value="bollingerBands">Bollinger Bands</option>
                                <si">RSI Strategy</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="timePeriod">Time Period (days):</label>
                            <input type="number" id="timePeriod" min="30" max="365" value="90">
                        </div>
                        <div class="form-group">
                            <label for="initialInvestment">Initial Investment ($):</label>
                            <input type="number" id="initialInvestment" min="1000" max="100000" value="10000">
                        </div>
                        <div class="form-group">
                            <label for="riskPerTrade">Risk Per Trade (%):</label>
                            <input type="number" id="riskPerTrade" min="1" max="5" value="2">
                        </div>
                        <button type="submit" class="backtest-button">Run Backtest</button>
                    </form>

                    <div class="backtest-results" id="backtestResults">
                        <h3>Backtest Results</h3>
                        <div class="results-grid">
                            <div class="result-card">
                                <h4>Total Return</h4>
                                <p id="totalReturn">-</p>
                            </div>
                            <div class="result-card">
>Annualized Return</h4>
                                <p id="annualizedReturn>
                            </div>
                            <div class="result-card">
                                <h4>Sharpe Ratio</h4>
                                <p id="sharpeRatio>
                            </div>
                            <div class="result-card">
                                <h4>Max Drawdown</h4>
                                <p id="maxDrawdown">-</p>
                            </div>
                            <div class="result-card">
                                <h4>Win Rate</h4>
                                <p id="winRate">-</p>
                            </div>
                            <div class="result-card">
                                <h4>Profit Factor</h4>
                                <p id="profitFactor">-</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <footer>
        <p>&copy; 2023 EOD AI Stock Market Psychic. All rights reserved.</p>
    </footer>

    <script>
        // API configuration
        const API_KEY = 'YOUR_EOD_API_KEY';
        const BASE_URL = 'https://eodhistoricaldata.com/api';

        // DOM elements
        const stockSymbolInput = document.getElementById('stockSymbol');
        const searchButton = document.getElementById('searchButton');
        const stockInfo = document.getElementById('stockInfo');
        const chartContainer = document.getElementById('chart');
        const rsiElement = document.getElementById('rsi');
        const macdElement = document.getElementById('macd');
        const stochasticElement = document.getElementById('stochastic');
        const adxElement = document.getElementById('adx');
        const predictedPriceElement = document.getElementById('predictedPrice');
        const trendElement = document.getElementById('trend');
        const backtestForm = document.getElementById('backtestForm');
        const backtestResults = document.getElementById('backtestResults');

        // Chart variables
        let chart;
        let candlestickSeries;
        let volumeSeries;

        // Initialize chart
        function initChart() {
            const chartOptions = {
                layout: {
                    background: { type: 'solid', color: 'white' },
                    textColor: '#333',
                },
                grid: {
                    vertLines: { color: '#e1e1e1' },
                    horzLines: { color: '#e1e1e1' },
                },
                rightPriceScale: {
                    borderVisible: false,
                },
                timeScale: {
                    borderVisible: false,
                },
                handleScroll: {
                    mouseWheel: false,
                    pressedMouseMove: true,
                },
                handleScalePressedMouseMove: true,
                },
            };

            chart = LightweightCharts.createChart(chartContainer, chartOptions);

            candlestickSeries = chart.addCandlestickSeries({
                upColor: '#26a69a',
                downColor: '#ef5350',
                borderVisible: false,
                wickUpColor: '#26a69a',
                wickDownColor: '#ef5350',
            });

            volumeSeries = chart.addHistogramSeries({
                color: '#78909c',
                priceFormat: {
                    type: 'volume',
                },
                priceScaleId: '',
                scaleMargins: {
                    top: 0.8,
                    bottom: 0,
                },
            });
        }

        // Fetch stock data
        async function fetchStockData(symbol) {
            try {
                // Fetch fundamental data
                const fundamentalUrl = `${BASE_URL}/fundamentals/${symbol}?api_token=${API_KEY}`;
                const fundamentalResponse = await fetch(fundamentalUrl);
                const fundamentalData = await fundamentalResponse.json();

                // Fetch historical data
                const historicalUrl = `${BASE_URL}/eod/${symbol}?api_token=${API_KEY}&fmt=json&filter=history`;
                const historicalResponse = await fetch(historicalUrl);
                const historicalData = await historicalResponse.json();

                return { fundamentalData, historicalData };
            } catch (error) {
                console.error('Error fetching stock data:', error);
                return null;
            }
        }

        // Update stock information
        function updateStockInfo(fundamentalData) {
            document.getElementById('symbol').textContent = fundamentalData.General.Code;
            document.getElementById('companyName').textContent = fundamentalData.General.Name;
            document.getElementById('exchange').textContent = fundamentalData.General.Exchange;
            document.getElementById('currency').textContent = fundamentalData.General.CurrencyCode;
            document.getElementById('currentPrice').textContent = fundamentalData.Valuation.Close.toFixed(2);
            document.getElementById('previousClose').textContent = fundamentalData.Valuation.PreviousClose.toFixed(2);
            document.getElementById('change').textContent = fundamentalData.Valuation.Change.toFixed(2);
            document.getElementById('changePercent').textContent = `${fundamentalData.Valuation.ChangeP.toFixed(2)}%`;
        }

        // Update chart with historical data
        function updateChart(historicalData) {
            const candlestickData = historicalData.map(item => ({
                time: item.date,
                open: item.open,
                high: item.high,
                low: item.low,
                close: item.close,
            }));

            const volumeData = historicalData.map(item => ({
                time: item.date,
                value: item.volume,
                color: item.close >= item.open ? '#26a69a' : '#ef5350',
            }));

            candlestickSeries.setData(candlestickData);
            volumeSeries.setData(volumeData);
        }

        // Calculate technical indicators
        function calculateTechnicalIndicators(historicalData) {
            // Calculate RSI (14)
            let rsi = 0;
            const closes = historicalData.map(item => item.close);
            const changes = closes.map((value, index) => index > 0 ? value - closes[index - 1] : 0);
            const gains = changes.map(change => change > 0 ? change : 0);
            const losses = changes.map(change => change < 0 ? Math.abs(change) : 0);

            const avgGain = gains.slice(1, 15).reduce((sum, value) => sum + value, 0) / 14;
            const avgLoss = losses.slice(1, 15).reduce((sum, value) => sum + value, 0) / 14;

            if (avgLoss !== 0) {
                const rs = avgGain / avgLoss;
                rsi = 100 - (100 / (1 + rs));
            }

            // Calculate MACD
            const macd = calculateMACD(historicalData);

            // Calculate Stochastic
            const stochastic = calculateStochastic(historicalData);

            // Calculate ADX
            const adx = calculateADX(historicalData);

            return { rsi, macd, stochastic, adx };
        }

        // Calculate MACD
        function calculateMACD(historicalData) {
            const closes = historicalData.map(item => item.close);
            const ema12 = calculateEMA(closes, 12);
            const ema26 = calculateEMA(closes, 26);
            const macdLine = ema12.map((value, index) => value - ema26[index]);
            const signalLine = calculateEMA(macdLine, 9);
            const histogram = macdLine.map((value, index) => value - signalLine[index]);

            return {
                line: macdLine[macdLine.length - 1].toFixed(2),
                signal: signalLine[signalLine.length - 1].toFixed(2),
                histogram: histogram[histogram.length - 1].toFixed(2),
            };
        }

        // Calculate EMA
        function calculateEMA(data, period) {
            const k = 2 / (period + 1);
            const ema = [data[0]];

            for (let i = 1; i < data.length; i++) {
                ema.push(data[i] * k + ema[i - 1] * (1 - k));
            }

            return ema;
        }

        // Calculate Stochastic
        function calculateStochastic(historicalData) {
            const closes = historicalData.map(item => item.close);
            const highs = historicalData.map(item => item.high);
            const lows = historicalData.map(item => item.low);

            const kPeriod = 14;
            const kValues = [];

            for (let i = kPeriod - 1; i < closes.length; i++) {
                const periodHigh = Math.max(...highs.slice(i - kPeriod + 1, i + 1));
                const periodLow = Math.min(...lows.slice(i - kPeriod + 1, i + 1));
                const k = ((closes[i] - periodLow) / (periodHigh - periodLow)) * 100;
                kValues.push(k);
            }

            const dPeriod = 3;
            const dValues = calculateSMA(kValues, dPeriod);

            return {
                k: kValues[kValues.length - 1].toFixed(2),
                d: dValues[dValues.length - 1].toFixed(2),
            };
        }

        // Calculate SMA
        function calculateSMA(data, period) {
            const sma = [];

            for (let i = period - 1; i < data.length; i++) {
                const sum = data.slice(i - period + 1, i + 1).reduce((sum, value) => sum + value, 0);
                sma.push(sum / period);
            }

            return sma;
        }

        // Calculate ADX
        function calculateADX(historicalData) {
            const period = 14;
            const highs = historicalData.map(item => item.high);
            const lows = historicalData.map(item => item.low);
            const closes = historicalData.map(item => item.close);

            const trValues = [];
            const dmPlusValues = [];
            const dmMinusValues = [];

            for (let i = 1; i < historicalData.length; i++) {
                const tr = Math.max(
                    highs[i] - lows[i],
                    Math.abs(highs[i] - closes[i - 1]),
                    Math.abs(lows[i] - closes[i - 1])
                );
                trValues.push(tr);

                const dmPlus = highs[i] > closes[i - 1] ? Math.max(highs[i] - closes[i - 1], 0) : 0;
                dmPlusValues.push(dmPlus);

                const dmMinus = lows[i] < closes[i - 1] ? Math.max(closes[i - 1] - lows[i], 0) : 0;
                dmMinusValues.push(dmMinus);
            }

            const atrValues = calculateSMA(trValues, period);
            const diPlusValues = [];
            const diMinusValues = [];

            for (let i = period - 1; i < trValues.length; i++) {
                const sumDmPlus = dmPlusValues.slice(i - period + 1, i + 1).reduce((sum, value) => sum + value, 0);
                const sumDmMinus = dmMinusValues.slice(i - period + 1, i + 1).reduce((sum, value) => sum + value, 0);

                const diPlus = (sumDmPlus / atrValues[i - period + 1]) * 100;
                diPlusValues.push(diPlus);

                const diMinus = (sumDmMinus / atrValues[i - period + 1]) * 100;
                diMinusValues.push(diMinus);
            }

            const dxValues = diPlusValues.map((value, index) => {
                const sum = value + diMinusValues[index];
                return sum !== 0 ? (Math.abs(value - diMinusValues[index]) / sum) * 100 : 0;
            });

            const adxValues = calculateSMA(dxValues, period);

            return adxValues[adxValues.length - 1].toFixed(2);
        }

        // Update technical indicators
        function updateTechnicalIndicators(indicators) {
            rsiElement.textContent = indicators.rsi.toFixed(2);
            macdElement.textContent = `${indicators.macd.line} (${indicators.macd.histogram})`;
            stochasticElement.textContent = `${indicators.stochastic.k} (${indicators.stochastic.d})`;
            adxElement.textContent = indicators.adx;
        }

        // Predict stock price
        function predictStockPrice(historicalData) {
            // Simple moving average prediction
            const period = 50;
            const closes = historicalData.map(item => item.close);
            const sma = calculateSMA(closes, period);
            const predictedPrice = sma[sma.length - 1];

            // Determine trend
            const trend = predictedPrice > closes[closes.length - 1] ? 'Up' : 'Down';

            return { predictedPrice: predictedPrice.toFixed(2), trend };
        }

        // Update prediction
        function updatePrediction(prediction) {
            predictedPriceElement.textContent = prediction.predictedPrice;
            trendElement.textContent = prediction.trend;
            trendElement.className = prediction.trend === 'Up' ? 'prediction-trend up' : 'prediction-trend down';
        }

        // Backtest strategy
        function backtestStrategy(historicalData, strategy, timePeriod, initialInvestment, riskPerTrade) {
            // Convert timePeriod to number of data points
            const dataPoints = Math.min(timePeriod, historicalData.length);

            // Slice the historical data based on timePeriod
            const testData = historicalData.slice(-dataPoints);

            // Initialize variables
            let position = 0; // 0: no position, 1: long, -1: short
            let entryPrice = 0;
            let equity = initialInvestment;
            let maxEquity = initialInvestment;
            let drawdown = 0;
            let maxDrawdown = 0;
            let trades = 0;
            let winningTrades = 0;
            let totalProfit = 0;

            // Strategy parameters
            const movingAveragePeriod = 20;
            const bollingerBandsPeriod = 20;
            const bollingerBandsDeviation = 2;
            const rsiOverbought = 70;
            const rsiOversold = 30;

            // Calculate indicators
            const closes = testData.map(item => item.close);
            const movingAverage = calculateSMA(closes, movingAveragePeriod);
            const bollingerBands = calculateBollingerBands(closes, bollingerBandsPeriod, bollingerBandsDeviation);
            const rsiValues = calculateRSI(closes, 14);

            // Backtest loop
            for (let i = movingAveragePeriod; i < testData.length; i++) {
                const currentPrice = testData[i].close;
                const previousPrice = testData[i - 1].close;

                // Execute strategy
                switch (strategy) {
                    case 'movingAverage':
                        if (position === 0) {
                            if (currentPrice > movingAverage[i - movingAveragePeriod]) {
                                // Buy signal
                                position = 1;
                                entryPrice = currentPrice;
                                trades++;
                            } else if (currentPrice < movingAverage[i - movingAveragePeriod]) {
                                // Sell signal
                                position = -1;
                                entryPrice = currentPrice;
                                trades++;
                            }
                        } else if (position === 1 && currentPrice < movingAverage[i - movingAveragePeriod]) {
                            // Sell signal
                            const profit = (currentPrice - entryPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        } else if (position === -1 && currentPrice > movingAverage[i - movingAveragePeriod]) {
                            // Buy signal
                            const profit = (entryPrice - currentPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        }
                        break;

                    case 'bollingerBands':
                        if (position === 0) {
                            if (currentPrice < bollingerBands.lower[i - bollingerBandsPeriod]) {
                                // Buy signal
                                position = 1;
                                entryPrice = currentPrice;
                                trades++;
                            } else if (currentPrice > bollingerBands.upper[i - bollingerBandsPeriod]) {
                                // Sell signal
                                position = -1;
                                entryPrice = currentPrice;
                                trades++;
                            }
                        } else if (position === 1 && currentPrice > bollingerBands.middle[i - bollingerBandsPeriod]) {
                            // Sell signal
                            const profit = (currentPrice - entryPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        } else if (position === -1 && currentPrice < bollingerBands.middle[i - bollingerBandsPeriod]) {
                            // Buy signal
                            const profit = (entryPrice - currentPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        }
                        break;

                    case 'rsi':
                        if (position === 0) {
                            if (rsiValues[i - 1] < rsiOversold) {
                                // Buy signal
                                position = 1;
                                entryPrice = currentPrice;
                                trades++;
                            } else if (rsiValues[i - 1] > rsiOverbought) {
                                // Sell signal
                                position = -1;
                                entryPrice = currentPrice;
                                trades++;
                            }
                        } else if (position === 1 && rsiValues[i - 1] > rsiOverbought) {
                            // Sell signal
                            const profit = (currentPrice - entryPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        } else if (position === -1 && rsiValues[i - 1] < rsiOversold) {
                            // Buy signal
                            const profit = (entryPrice - currentPrice) / entryPrice * 100;
                            equity += initialInvestment * (profit / 100);
                            totalProfit += profit;
                            if (profit > 0) winningTrades++;
                            position = 0;
                        }
                        break;
                }

                // Update max equity and drawdown
                if (equity > maxEquity) {
                    maxEquity = equity;
                }

                drawdown = (maxEquity - equity) / maxEquity * 100;
                if (drawdown > maxDrawdown) {
                    maxDrawdown = drawdown;
                }
            }

            // Close any open position at the end
            if (position !== 0) {
                const currentPrice = testData[testData.length - 1].close;
                const profit = position === 1 ?
                    (currentPrice - entryPrice) / entryPrice * 100 :
                    (entryPrice - currentPrice) / entryPrice * 100;
                equity += initialInvestment * (profit / 100);
                totalProfit += profit;
                if (profit > 0) winningTrades++;
            }

            // Calculate performance metrics
            const totalReturn = (equity - initialInvestment) / initialInvestment * 100;
            const annualizedReturn = Math.pow(1 + totalReturn / 100, 365 / timePeriod) - 1;
            const sharpeRatio = totalReturn / Math.sqrt(timePeriod);
            const winRate = trades > 0 ? winningTrades / trades * 100 : 0;
            const profitFactor = totalProfit > 0 ? Math.abs(totalProfit) / totalProfit : 0;

            return {
                totalReturn: totalReturn.toFixed(2),
                annualizedReturn: (annualizedReturn * 100).toFixed(2),
                sharpeRatio: sharpeRatio.toFixed(2),
                maxDrawdown: maxDrawdown.toFixed(2),
                winRate: winRate.toFixed(2),
                profitFactor: profitFactor.toFixed(2),
            };
        }

        // Calculate Bollinger Bands
        function calculateBollingerBands(data, period, deviation) {
            const middle = calculateSMA(data, period);
            const standardDeviations = [];

            for (let i = period - 1; i < data.length; i++) {
                const slice = data.slice(i - period + 1, i + 1);
                const mean = slice.reduce((sum, value) => sum + value, 0) / period;
                const squaredDifferences = slice.map(value => Math.pow(value - mean, 2));
                const variance = squaredDifferences.reduce((sum, value) => sum + value, 0) / period;
                const standardDeviation = Math.sqrt(variance);
                standardDeviations.push(standardDeviation);
            }

            const upper = middle.map((value, index) => value + deviation * standardDeviations[index]);
            const lower = middle.map((value, index) => value - deviation * standardDeviations[index]);

            return { middle, upper, lower };
        }

        // Calculate RSI
        function calculateRSI(data, period) {
            const changes = data.map((value, index) => index > 0 ? value - data[index - 1] : 0);
            const gains = changes.map(change => change > 0 ? change : 0);
            const losses = changes.map(change => change < 0 ? Math.abs(change) : 0);

            const avgGain = gains.slice(1, period + 1).reduce((sum, value) => sum + value, 0) / period;
            const avgLoss = losses.slice(1, period + 1).reduce((sum, value) => sum + value, 0) / period;

            const rsiValues = [avgLoss !== 0 ? 100 - (100 / (1 + avgGain / avgLoss)) : 0];

            for (let i = period + 1; i < data.length; i++) {
                const gain = gains[i];
                const loss = losses[i];

                const newAvgGain = (avgGain * (period - 1) + gain) / period;
                const newAvgLoss = (avgLoss * (period - 1) + loss) / period;

                const rsi = newAvgLoss !== 0 ? 100 - (100 / (1 + newAvgGain / newAvgLoss)) : 0;
                rsiValues.push(rsi);

                avgGain = newAvgGain;
                avgLoss = newAvgLoss;
            }

            return rsiValues;
        }

        // Update backtest results
        function updateBacktestResults(results) {
            document.getElementById('totalReturn').textContent = `${results.totalReturn}%`;
            document.getElementById('annualizedReturn').textContent = `${results.annualizedReturn}%`;
            document.getElementById('sharpeRatio').textContent = results.sharpeRatio;
            document.getElementById('maxDrawdown').textContent = `${results.maxDrawdown}%`;
            document.getElementById('winRate').textContent = `${results.winRate}%`;
            document.getElementById('profitFactor').textContent = results.profitFactor;

            // Add color classes based on positive or negative values
            document.getElementById('totalReturn').className = results.totalReturn >= 0 ? 'positive' : 'negative';
            document.getElementById('annualizedReturn').className = results.annualizedReturn >= 0 ? 'positive' : 'negative';
            document.getElementById('sharpeRatio').className = results.sharpeRatio >= 0 ? 'positive' : 'negative';
            document.getElementById('maxDrawdown').className = results.maxDrawdown >= 0 ? 'positive' : 'negative';
            document.getElementById('winRate').className = results.winRate >= 0 ? 'positive' : 'negative';
            document.getElementById('profitFactor').className = results.profitFactor >= 0 ? 'positive' : 'negative';

            backtestResults.classList.add('active');
        }

        // Event listeners
        searchButton.addEventListener('click', async () => {
            const symbol = stockSymbolInput.value.trim().toUpperCase();
            if (!symbol) return;

            const data = await fetchStockData(symbol);
            if (!data) return;

            updateStockInfo(data.fundamentalData);
            updateChart(data.historicalData);

            const indicators = calculateTechnicalIndicators(data.historicalData);
            updateTechnicalIndicators(indicators);

            const prediction = predictStockPrice(data.historicalData);
            updatePrediction(prediction);
        });

        backtestForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const symbol = stockSymbolInput.value.trim().toUpperCase();
            if (!symbol) return;

            const strategy = document.getElementById('strategy').value;
            const timePeriod = parseInt(document.getElementById('timePeriod').value);
            const initialInvestment = parseFloat(document.getElementById('initialInvestment').value);
            const riskPerTrade = parseFloat(document.getElementById('riskPerTrade').value);

            const data = await fetchStockData(symbol);
            if (!data) return;

            const results = backtestStrategy(
                data.historicalData,
                strategy,
                timePeriod,
                initialInvestment,
                riskPerTrade
            );

            updateBacktestResults(results);
        });

        // Initialize the application
        function init() {
            initChart();
        }

        // Start the application
        init();
    </script>
</body>
</html>
```